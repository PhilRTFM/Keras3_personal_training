# PROMPT D’INGÉNIERIE — PROJET R "Keras3_personal_training"

──────────────────────────────────────────────
## 0) CONTEXTE & FICHIERS DISPONIBLES

Tu as à ta disposition les scripts sources en cours (format `.txt`), à refactorer et redistribuer en fichiers R :

- `models.txt`       ==> `models.R`
- `analysis.txt`     ==> `analysis.R`
- `metrics.txt`      ==> `metrics.R`
- `utils.txt`        ==> `utils.R`
- `run_iris.txt`     ==> `run_iris.R`
- `run_msleep.txt`   ==> `run_msleep.R`

──────────────────────────────────────────────
## 1) BONNES PRATIQUES À APPLIQUER

- **Commentaires** : uniformisation avec **Roxygen2** partout.
- **Pas d’installations/`library()`** dans les scripts.  
  Les dépendances doivent être listées dans **DESCRIPTION** (équivalent `requirements.txt` en Python) avec commentaire bref sur leur usage.
- **Toujours utiliser** `pkg::fun()` pour appeler une fonction externe.
- **Structure des fonctions** :
  - 1 paramètre par ligne dans la signature.
  - Bloc Roxygen complet avec `@param` (type + rôle), `@return`, `@examples`, `@export`.
  - `verbose` booléen (`TRUE/FALSE`), toujours en dernier paramètre, par défaut `FALSE`.
  - **Toujours un `return()`** explicite en sortie.
- **Suppression de `class_weight`** pour l’instant (non utilisé).
- **Exports graphiques** :
  - Format **PDF unique**, ratio **16:9**.
  - Chaque figure sur une page différente.
  - Nom du fichier **timestampé ISO 8601 (YYYY-MM-DD)**.
  - Points petits, ellipses optionnelles.
- **Factorisation modulaire** du code : séparation claire utils / modèles / visualisations / évaluations.

──────────────────────────────────────────────
## 2) PCA

- **Calculs** avec `FactoMineR::PCA()`.
- **Graphiques** avec `ggplot2` :
  - Graphique des individus (points colorés par groupe, ellipses optionnelles).
  - Cercle des corrélations (unit circle + noms des variables).
- Fournir une fonction combinée **2-panel** (`individus + corrélations`).

──────────────────────────────────────────────
## 3) MDS (Multidimensional Scaling)

- Objectif : réduire une matrice de distances (positive, symétrique) en 2D.
- **Implémentations** :
  - MDS métrique (`stats::cmdscale`).
  - MDS non-métrique (`MASS::isoMDS`).
- **Graphiques** :
  - Scatter plot (ggplot).
  - Shepard plot (distances originales vs dist réduites).
- **Stress de Kruskal** : affiché à **4 chiffres significatifs**.
- **Référence** :  
  https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-019-2780-y  
  Inclure la citation en commentaire Roxygen.

──────────────────────────────────────────────
## 4) ORGANISATION DU CODE

### Actuel :

Keras3_personal_training/
├─ DESCRIPTION
├─ NAMESPACE
├─ R/
│ ├─ models.R
│ ├─ analysis.R
│ └─ metrics.R
├─ inst/examples/
│ ├─ run_iris.R
│ └─ run_msleep.R
├─ man/
├─ tests/
├─ README.md
└─ .gitignore


### Cible (refactorisée) :

Keras3_personal_training/
├─ DESCRIPTION
├─ NAMESPACE
├─ R/
│ ├─ utils.R # Preprocessing + helpers + sauvegarde plots
│ ├─ suppervised_mod.R # Fonctions approche supervisée (MLP)
│ ├─ unsuppervised_mod.R # Fonctions approche non supervisée (Autoencodeur)
│ ├─ visualizations.R # PCA, MDS, plots ggplot2
│ ├─ eval_sup.R # Évaluation modèles supervisés
│ └─ eval_unsup.R # Évaluation modèles non supervisés
├─ inst/examples/
│ ├─ run_iris.R
│ └─ run_msleep.R
├─ man/
├─ README.md
└─ .gitignore


──────────────────────────────────────────────
## 5) EXEMPLES À PRODUIRE

### `run_iris.R`
- PCA + plots (individus + corrélations).
- MDS métrique et non-métrique (avec stress + Shepard).
- Entraînement d’un **MLP** (approche supervisée) :
  - Split stratifié + standardisation.
  - Confusion matrix + métriques.
  - Courbes d’apprentissage (accuracy/loss).
- Entraînement d’un **Autoencodeur** (approche non supervisée) :
  - Reconstruction X vs X’.
  - MSE, RMSE, MAE, (optionnel AUC-ROC/PR).
  - Courbes d’apprentissage.
  - Distribution des erreurs + scatter.
- Export de tous les résultats dans un PDF unique.

### `run_msleep.R`
- Preprocessing : séparer numériques et catégorielles.
- Numériques :
  - Tests de Cliff’s delta.
  - Visualisations (densité, corrélations).
- Catégorielles :
  - Matrices de corrélation.
  - Tests du Khi² ou Fisher selon effectifs.
- Objectif exploratoire : préparation pour apprentissage supervisé/non-supervisé.
- Export PDF unique.

──────────────────────────────────────────────
## 6) STRUCTURE DU DATASET M SLEEP

- Observations : 83 mammifères.
- Variables (11 colonnes) :
  - **Catégorielles** : name, genus, vore, order, conservation.
  - **Numériques** : sleep_total, sleep_rem, sleep_cycle, awake, brainwt, bodywt.
- Approche :  
  - Prédire variables catégorielles à partir des numériques.  
  - Reconstruction par autoencodeur.

──────────────────────────────────────────────
## 7) COMMENTAIRES DE CODE (Roxygen)

- Titre court.
- Description brève.
- `@param` (1 par ligne, type, description).
- `@return` (type + contenu détaillé).
- `@examples` simples.
- `@export`.

──────────────────────────────────────────────
## 8) BRANCHES GIT

- **exploration/** : scripts tests, prototypage rapide.
- **consolidation/** : version stabilisée, PR vers main.

──────────────────────────────────────────────
## 9) À PRODUIRE DANS TA RÉPONSE

1. **Liste des fonctions** attendues par fichier (nom, inputs typés, outputs).
2. **Code final** prêt à coller uniquement dans un second temps, l'utilisateur te demandera script par script:  
   - `R/utils.R`  
   - `R/suppervised_mod.R`  
   - `R/unsuppervised_mod.R`  
   - `R/visualizations.R`  
   - `R/eval_sup.R`  
   - `R/eval_unsup.R`  
   - `inst/examples/run_iris.R`  
   - `inst/examples/run_msleep.R`
3. **DESCRIPTION** (Imports listés).
4. **NAMESPACE** (exports/importFrom).
5. **README.md** minimal.
6. **.gitignore** adapté.
7. **Commandes de build** : `devtools::document()`, `devtools::check()`, `devtools::build()`.
8. **Checklist de validation** :
   - [ ] R CMD check sans erreur  
   - [ ] Pas de `library()` dans les sources  
   - [ ] Tous les blocs Roxygen complets  
   - [ ] Tous les `return()` présents  
   - [ ] Stress de Kruskal affiché à 4 chiffres  
   - [ ] PCA via FactoMineR + ggplot2  
   - [ ] PDF exportés 16:9 timestampés  
   - [ ] `class_weight` supprimé  
   - [ ] `verbose` toujours en dernier (FALSE par défaut)

# FIN DU PROMPT

